<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Functions to connect to Waters Unifi API and convert data to parquet or HDF5 format.">
<title>Unifi MS converter to Parquet and HDF5 formats • arcMS</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Unifi MS converter to Parquet and HDF5 formats">
<meta property="og:description" content="Functions to connect to Waters Unifi API and convert data to parquet or HDF5 format.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">arcMS</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/leesulab/arcMS/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="arcms">arcMS<a class="anchor" aria-label="anchor" href="#arcms"></a>
</h1></div>
<!-- badges: start -->
<!-- badges: end -->
<p><code>arcMS</code> can convert HDMS<sup>E</sup> data acquired with Waters UNIFI to tabular format for use in R or Python, with a small filesize when saved on disk.</p>
<p>Two output data file formats can be obtained:</p>
<ul>
<li><p>the <a href="https://parquet.apache.org/" class="external-link">Apache Parquet</a> format for minimal filesize and fast access. Two files are produced: one for MS data, one for metadata.</p></li>
<li><p>the <a href="https://www.hdfgroup.org/solutions/hdf5/" class="external-link">HDF5</a> format with all data and metadata in one file, fast access but larger filesize.</p></li>
</ul>
<p><code>arcMS</code> stands for <em>accessible</em>, <em>rapid</em> and <em>compact</em>, and is also based on the french word <em>arc</em>, which means <em>bow,</em> to emphasize that it is compatible with the <a href="https://arrow.apache.org/" class="external-link">Apache Arrow library</a>.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install <code>arcMS</code> in R with the following command:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"devtools"</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"leesulab/arcMS"</span><span class="op">)</span></span></code></pre></div>
<p>To use the HDF5 format, the <code>rhdf5</code> package needs to be installed:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"BiocManager"</span><span class="op">)</span></span>
<span><span class="fu">BiocManager</span><span class="fu">::</span><span class="fu">install</span><span class="op">(</span><span class="st">"rhdf5"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<p>First load the package:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/leesulab/arcMS/" class="external-link">"arcMS"</a></span><span class="op">)</span></span></code></pre></div>
<p>Then create connection parameters to the UNIFI API (retrieve token):</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">con</span> <span class="op">=</span> <span class="fu"><a href="reference/create_connection_params.html">create_connection_params</a></span><span class="op">(</span>apihosturl <span class="op">=</span> <span class="st">"http://localhost:50034/unifi/v1"</span>, identityurl <span class="op">=</span> <span class="st">"http://localhost:50333/identity/connect/token"</span><span class="op">)</span></span></code></pre></div>
<p>If <code>arcMS</code> and the <code>R</code> session are run from another computer than where the UNIFI API is installed, replace <code>localhost</code> by the IP address of the UNIFI API.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">con</span> <span class="op">=</span> <span class="fu"><a href="reference/create_connection_params.html">create_connection_params</a></span><span class="op">(</span>apihosturl <span class="op">=</span> <span class="st">"http://192.0.2.0:50034/unifi/v1"</span>, identityurl <span class="op">=</span> <span class="st">"http://192.0.2.0:50333/identity/connect/token"</span><span class="op">)</span></span></code></pre></div>
<p>Now these connection parameters will be used to access the UNIFI folders. The following function will show the list of folders and their IDs (e.g. <code>abe9c297-821e-4152-854a-17c73c9ff68c</code> in the example below).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">folders</span> <span class="op">=</span> <span class="fu"><a href="reference/folders_search.html">folders_search</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">folders</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                     id                name</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 abe9c297-821e-4152-854a-17c73c9ff68c          Christelle</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 dde4ecfc-fe08-4cb2-ad8a-c10f3e45f4dd Imports temporaires</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                          path folderType                             parentId</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3          Company/Christelle    Project 7c3a0fc7-3805-4c14-ab68-8da3e115702e</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 Company/Imports temporaires    Project 7c3a0fc7-3805-4c14-ab68-8da3e115702e</span></span></code></pre></div>
<p>With a folder ID, we can access the list of Analysis items in the folder:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ana</span> <span class="op">=</span> <span class="fu"><a href="reference/analysis_search.html">analysis_search</a></span><span class="op">(</span><span class="st">"abe9c297-821e-4152-854a-17c73c9ff68c"</span><span class="op">)</span></span>
<span><span class="va">ana</span></span></code></pre></div>
<p>Finally, with an Analysis ID, we can get the list of samples (injections) acquired in this Analysis:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">samples</span> <span class="op">=</span> <span class="fu"><a href="reference/get_samples_list.html">get_samples_list</a></span><span class="op">(</span><span class="st">"e236bf99-31cd-44ae-a4e7-74915697df65"</span><span class="op">)</span></span>
<span><span class="va">samples</span></span></code></pre></div>
<p>Once we get a sample ID, we can use it to download the sample data:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/convert_one_sample_data.html">convert_one_sample_data</a></span><span class="op">(</span>sample_id <span class="op">=</span> <span class="st">"0134efbf-c75a-411b-842a-4f35e2b76347"</span><span class="op">)</span></span></code></pre></div>
<p>This command will get the sample name (<code>sample_name</code>) and its parent analysis (<code>analysis_name</code>), create a folder named <code>analysis_name</code> in the working directory and save the sample data with the name <code>sample_name.parquet</code> and its metadata with the name <code>sample_name-metadata.parquet</code>.</p>
<p>With an Analysis ID, we can convert and save all samples from the chosen Analysis:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/convert_all_samples_data.html">convert_all_samples_data</a></span><span class="op">(</span>analysis_id <span class="op">=</span> <span class="st">"e236bf99-31cd-44ae-a4e7-74915697df65"</span><span class="op">)</span></span></code></pre></div>
<p>To use the HDF5 format instead of Parquet, the format argument can be used as below:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/convert_one_sample_data.html">convert_one_sample_data</a></span><span class="op">(</span>sample_id <span class="op">=</span> <span class="st">"0134efbf-c75a-411b-842a-4f35e2b76347"</span>, format <span class="op">=</span> <span class="st">"hdf5"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/convert_all_samples_data.html">convert_all_samples_data</a></span><span class="op">(</span>analysis_id <span class="op">=</span> <span class="st">"e236bf99-31cd-44ae-a4e7-74915697df65"</span>, format <span class="op">=</span> <span class="st">"hdf5"</span><span class="op">)</span></span></code></pre></div>
<p>This will save the samples data and metadata in the same <code>file.h5</code> file.</p>
<p>Parquet or HDF5 files can be opened easily in <code>R</code> with the <code>arrow</code> or <code>rhdf5</code> packages. Parquet files contain both low and high energy spectra (HDMSe), and HDF5 files contain low energy in the “ms1” dataset, high energy in the “ms2” dataset, and metadata in the “metadata” dataset. The <code>fromJSON</code> function from <code>jsonlite</code> package will import the metadata json file (associated with the Parquet file) as a list of dataframes.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sampleparquet</span> <span class="op">=</span> <span class="fu">arrow</span><span class="fu">::</span><span class="fu"><a href="https://arrow.apache.org/docs/r/reference/read_parquet.html" class="external-link">read_parquet</a></span><span class="op">(</span><span class="st">"sample.parquet"</span><span class="op">)</span></span>
<span><span class="va">metadataparquet</span> <span class="op">=</span> <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html" class="external-link">fromJSON</a></span><span class="op">(</span><span class="st">"sample-metadata.json"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">samplems1hdf5</span> <span class="op">=</span> <span class="fu">rhdf5</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rhdf5/man/h5_read.html" class="external-link">h5read</a></span><span class="op">(</span><span class="st">"sample.h5"</span>, name <span class="op">=</span> <span class="st">"ms1"</span><span class="op">)</span></span>
<span><span class="va">samplems2hdf5</span> <span class="op">=</span> <span class="fu">rhdf5</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rhdf5/man/h5_read.html" class="external-link">h5read</a></span><span class="op">(</span><span class="st">"sample.h5"</span>, name <span class="op">=</span> <span class="st">"ms2"</span><span class="op">)</span></span>
<span><span class="va">samplemetadatahdf5</span> <span class="op">=</span> <span class="fu">rhdf5</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rhdf5/man/h5_read.html" class="external-link">h5read</a></span><span class="op">(</span><span class="st">"sample.h5"</span>, name <span class="op">=</span> <span class="st">"samplemetadata"</span><span class="op">)</span></span>
<span><span class="va">spectrummetadatahdf5</span> <span class="op">=</span> <span class="fu">rhdf5</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/rhdf5/man/h5_read.html" class="external-link">h5read</a></span><span class="op">(</span><span class="st">"sample.h5"</span>, name <span class="op">=</span> <span class="st">"spectrummetadata"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="shiny-app">Shiny App<a class="anchor" aria-label="anchor" href="#shiny-app"></a>
</h2>
<p>A Shiny application is available to use the package easily. To run the app, just use the following command (it might need to install a few additional packages):</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/run_app.html">run_app</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/leesulab/arcMS/" class="external-link">Browse source code</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing arcMS</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Julien Le Roux <br><small class="roles"> Author, maintainer </small>  </li>
<li>Julien Sade <br><small class="roles"> Author </small>  </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Julien Le Roux, Julien Sade.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
